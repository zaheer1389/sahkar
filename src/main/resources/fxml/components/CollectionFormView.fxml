<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import com.badargadh.sahkar.component.DateTimePicker?>

<HBox spacing="20.0" style="-fx-background-color: #f1f3f5;" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.badargadh.sahkar.controller.CollectionController">
    <padding>
        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
    </padding>

    <VBox spacing="15.0" minWidth="380.0" maxWidth="400.0" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 12; -fx-border-color: #dee2e6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 10, 0, 0, 5);">
        <children>
            <Label style="-fx-font-size: 18; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="New Payment Collection" />
            <Separator />
            
            <VBox spacing="5.0">
                <Label text="Payment Date" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" />
                <DateTimePicker fx:id="paymentDateTimePicker" />
            </VBox>

            <VBox spacing="5.0">
                <Label text="Member Number" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" />
                <HBox spacing="10">
                    <TextField fx:id="txtMemberNumber" HBox.hgrow="ALWAYS" prefHeight="35.0" promptText="Enter No. &amp; Press Enter" onAction="#handleFetchMember" />
                    <Button onAction="#handleFetchMember" prefHeight="35.0" style="-fx-cursor: hand; -fx-background-color: #3498db; -fx-text-fill: white;" text="Fetch" />
                </HBox>
                <Label fx:id="lblMemberStatus" style="-fx-text-fill: red; -fx-font-size: 13;-fx-font-weight: bold;" text="" />             
            </VBox>

            <VBox fx:id="vboxStatus" spacing="8.0" visible="false" style="-fx-padding: 12; -fx-background-color: #fdfdfe; -fx-background-radius: 8; -fx-border-color: #e9ecef; -fx-border-style: dashed;">
                <children>
                    <Label fx:id="lblMemberName" style="-fx-font-size: 14; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="Name: -" />
                    <Label fx:id="lblLoanStatus" style="-fx-font-size: 13; -fx-font-weight: bold; -fx-text-fill: #e67e22;" text="LOAN: ACTIVE" />
                    <Label fx:id="lblBalanceInfo" style="-fx-text-fill: #2c3e50; -fx-font-size: 13; -fx-font-weight: bold;" text="• Current Balance: ₹0.00" />
                    </children>
            </VBox>
            <VBox fx:id="vboxCollectionForm" disable="true" spacing="15.0">
                <children>
                    <HBox spacing="15">
                        <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                            <Label text="EMI Amount" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" />
                            <ComboBox fx:id="cmbEmiAmount" maxWidth="Infinity" prefHeight="40.0" />
                        </VBox>
                        <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                            <Label text="Monthly Fees" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" />
                            <TextField fx:id="txtMonthlyFees" editable="false" prefHeight="40.0" style="-fx-background-color: #f8f9fa;" />
                        </VBox>
                    </HBox>

                    <HBox spacing="20">
                        <VBox spacing="5">
                            <Label text="Full Payment (Alt+F)" style="-fx-font-size: 11;"/>
                            <ToggleButton fx:id="btnFullPayment" text="NO" onAction="#handleFullPaymentToggle" prefWidth="80" style="-fx-cursor: hand;" />
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Add Remarks?" style="-fx-font-size: 11;"/>
                            <ToggleButton fx:id="btnToggleRemarks" text="NO" onAction="#handleRemarksToggle" prefWidth="80" style="-fx-cursor: hand;" />
                        </VBox>
                    </HBox>

                    <TextArea fx:id="txtRemarks" visible="false" managed="false" prefHeight="60" promptText="Enter notes..." wrapText="true" />

				<HBox spacing="15" alignment="CENTER" maxWidth="Infinity">
    <children>
        <Button fx:id="btnSubmit" 
                defaultButton="true" 
                maxWidth="Infinity" 
                HBox.hgrow="ALWAYS" 
                onAction="#handleSavePayment" 
                prefHeight="45.0" 
                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;" 
                text="ADD PAYMENT" />
                                            
        <Button fx:id="btnReset" 
                maxWidth="Infinity" 
                HBox.hgrow="ALWAYS" 
                onAction="#handleReset" 
                prefHeight="45.0" 
                style="-fx-background-color: #2c3e50; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;" 
                text="RESET" />
    </children>
</HBox>
                    
                </children>
            </VBox>
        </children>
    </VBox>

    <VBox spacing="10.0" HBox.hgrow="ALWAYS" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 12; -fx-border-color: #dee2e6;">
        <children>
            <HBox alignment="CENTER_LEFT">
                <children>
                    <Label style="-fx-font-size: 16; -fx-font-weight: bold; -fx-text-fill: #34495e;" text="Today's Collections" />
                    <Region HBox.hgrow="ALWAYS" />
                    <Button onAction="#dropPayments" text="Drop Payments" style="-fx-background-color: #2c3e50; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;" />
                </children>
            </HBox>
            <VBox spacing="10.0" VBox.vgrow="ALWAYS" HBox.hgrow="ALWAYS" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 12; -fx-border-color: #dee2e6;">
    <children>
        <TableView fx:id="tblCollections" VBox.vgrow="ALWAYS">
            <columns>
            <TableColumn fx:id="colSrNo" prefWidth="50.0" text="Sr No." />
                <TableColumn fx:id="colMemberNo" prefWidth="80.0" text="Member No" />
                <TableColumn fx:id="colMember" prefWidth="250.0" text="Member Name" />
                <TableColumn fx:id="colEmi" prefWidth="100.0" text="EMI" />
                <TableColumn fx:id="colFees" prefWidth="100.0" text="Fees" />
                <TableColumn fx:id="colTotal" prefWidth="100.0" text="Full Payment Amount" />
                <TableColumn fx:id="colStatus" prefWidth="100.0" text="Full Payment?" />
                <TableColumn fx:id="colAction" prefWidth="80.0" text="Action" />
            </columns>
            <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
        </TableView>

        <GridPane hgap="20" vgap="5" style="-fx-background-color: #f8f9fa; -fx-padding: 10; -fx-border-color: #ced4da; -fx-border-radius: 5;">
            <columnConstraints>
                <ColumnConstraints minWidth="150" />
                <ColumnConstraints minWidth="150" />
                <ColumnConstraints minWidth="150" />
            </columnConstraints>
            <children>
                <Label fx:id="lblTotalFees" text="Total Fees: ₹0" GridPane.rowIndex="0" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                <Label fx:id="lblTotalEmi" text="Total EMI: ₹0" GridPane.rowIndex="0" GridPane.columnIndex="1" style="-fx-font-weight: bold;"/>
                <Label fx:id="lblGrandTotal" text="Grand Total: ₹0" GridPane.rowIndex="0" GridPane.columnIndex="2" style="-fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                
                <Label fx:id="lblFullPayCount" text="Full Payments: 0" GridPane.rowIndex="1" GridPane.columnIndex="0" />
                <Label fx:id="lblPartialPayCount" text="Partial Payments: 0" GridPane.rowIndex="1" GridPane.columnIndex="1" />
                <Label fx:id="lblTotalFullAmt" text="Sum of Full Amts: ₹0" GridPane.rowIndex="1" GridPane.columnIndex="2" />
                
                <Label fx:id="lblTotalAmt" text="Total Payment to be collect: ₹0" GridPane.rowIndex="2" GridPane.columnIndex="1" style="-fx-font-size: 16; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
            </children>
        </GridPane>
        <HBox spacing="15.0" alignment="CENTER_LEFT" style="-fx-background-color: #e9ecef; -fx-padding: 10; -fx-background-radius: 8;">
    <children>
    	<Label text="Collected At:" style="-fx-font-weight: bold;" />
    	<ComboBox fx:id="cmbCollectionLocation" maxWidth="Infinity" prefWidth="150.0" prefHeight="40.0" />
    	<Region HBox.hgrow="ALWAYS" />
        <Label text="Depositor Details:" style="-fx-font-weight: bold;" />
        <TextField fx:id="txtDepositorMemberNo" prefWidth="80.0" promptText="DepositorMember No" onAction="#handleFetchDepositor" />
        <TextField fx:id="txtDepositorName" editable="true" HBox.hgrow="ALWAYS" promptText="Depositor Name" style="-fx-background-color: #f8f9fa;" />
    </children>
</HBox>

<HBox alignment="CENTER_RIGHT" spacing="15">
    <padding>
        <Insets top="10" />
    </padding>
    <Button fx:id="btnDepositAll" onAction="#handleDepositAll" prefHeight="45.0" prefWidth="200.0" 
            style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14; -fx-cursor: hand;" 
            text="DEPOSIT COLLECTIONS" />
</HBox>
    </children>
</VBox>
        </children>
    </VBox>
</HBox>