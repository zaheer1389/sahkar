<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<StackPane xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.badargadh.sahkar.controller.LoanPlanningController">
    <children>
        <VBox spacing="20" style="-fx-padding: 25; -fx-background-color: #f1f3f5;">
            <children>
                <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10; -fx-border-color: #dee2e6;">
                     <VBox>
                        <Label text="Loan Draw Planning" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <!--<Label fx:id="lblMonthInfo" text="Financial Period: Loading..." style="-fx-text-fill: #7f8c8d;" />-->
                    </VBox>
                    <Region HBox.hgrow="ALWAYS" />
                    <HBox spacing="10" alignment="CENTER_RIGHT">
                        <Button fx:id="btnRefresh" onAction="#refresh" text="ðŸ”„ Recalculate Liquidity" 
                                style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 15;" />
                        <Button fx:id="btnRunDraw" onAction="#executeComputerizedDraw" text="ðŸš€ RUN COMPUTERIZED DRAW" 
                                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 15;" />
                    </HBox>
                </HBox>

                <HBox spacing="20" VBox.vgrow="ALWAYS">
                    <children>
                        <VBox spacing="15" prefWidth="450" minWidth="450">
                            <children>
                                <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-border-color: #dee2e6;">
                                    <children>
                                        <Label text="ESTIMATED TOTAL INCOME" style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14;" />
                                        <Label fx:id="lblNetAvailable" text="â‚¹ 0.00" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: #27ae60;" />
                                        <Separator />
                                        <GridPane vgap="12" hgap="10">
                                            <columnConstraints>
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="250" />
                                                <ColumnConstraints hgrow="SOMETIMES" minWidth="120" halignment="RIGHT" />
                                            </columnConstraints>
                                            <children>
                                                <Label text="1. Opening Balance" GridPane.rowIndex="0" />
                                                <Label fx:id="lblOpeningBal" text="â‚¹ 0" GridPane.rowIndex="0" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />
                                                <Label text="2. Expected Monthly Fees" GridPane.rowIndex="1" />
                                                <Label fx:id="lblExpectedFees" text="â‚¹ 0" GridPane.rowIndex="1" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />
                                                <Label text="3. Recurring EMIs (Old)" GridPane.rowIndex="2" />
                                                <Label fx:id="lblExpectedEmi" text="â‚¹ 0" GridPane.rowIndex="2" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />
                                                <Label text="4. Fresh Loan EMIs (@ â‚¹200)" GridPane.rowIndex="3" />
                                                <Label fx:id="lblFreshLoansVirtualEmi" text="â‚¹ 0" GridPane.rowIndex="3" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />
                                                <Label text="5. Full Payments" GridPane.rowIndex="4" />
                                                <Label fx:id="lblFullPayments" text="â‚¹ 0" GridPane.rowIndex="4" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />
                                                <Label text="6. New Member Fee Deductions" GridPane.rowIndex="5" />
                                                <Label fx:id="lblNewMemberFeeDeductions" text="â‚¹ 0" GridPane.rowIndex="5" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />                                                                                                                                               
                                                <Label text="7. Other Credits" GridPane.rowIndex="6" />
                                                <Label fx:id="lblMiscCredis" text="â‚¹ 0" GridPane.rowIndex="6" GridPane.columnIndex="1" style="-fx-font-weight: bold;" />                                                                                                                                                                                               
                                                <Label text="8. Less: Eligible Refunds" GridPane.rowIndex="7" style="-fx-text-fill: #e74c3c;" />
                                                <Label fx:id="lblRefunds" text="â‚¹ 0" GridPane.rowIndex="7" GridPane.columnIndex="1" style="-fx-font-weight: bold; -fx-text-fill: #e74c3c;" />
                                            </children>
                                        </GridPane>
                                    </children>
                                </VBox>
                                <!--<VBox spacing="10" alignment="CENTER" style="-fx-background-color: #2c3e50; -fx-padding: 30; -fx-background-radius: 15;">
                                    <children>
                                        <Label text="DRAW DECISION SUPPORT" style="-fx-text-fill: #bdc3c7; -fx-font-weight: bold; -fx-font-size: 18;" />
                                        <Label fx:id="lblPossible50k" text="0" style="-fx-font-size: 50; -fx-font-weight: bold; -fx-text-fill: #f1c40f;" />
                                        <Label text="LOANS CAN BE OPENED" style="-fx-text-fill: #f1c40f; -fx-font-weight: bold; -fx-font-size: 16;" />
                                    </children>
                                </VBox>-->
                                <VBox spacing="15" style="-fx-background-color: #ffffff; -fx-padding: 20; -fx-background-radius: 15; -fx-border-color: #e9ecef; -fx-border-radius: 15; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 5);">
								    <children>
								        <Label text="LOAN DECISION SUPPORT" style="-fx-font-size: 14; -fx-font-weight: bold; -fx-text-fill: #34495e; -fx-letter-spacing: 1px;"/>
								        
								        <HBox spacing="30" alignment="CENTER_LEFT">
								            <children>
								            
								            	<VBox alignment="CENTER" spacing="8" HBox.hgrow="ALWAYS" style="-fx-background-color: #f8f9fa; -fx-padding: 15; -fx-background-radius: 10; -fx-border-color: #7f8c8d; -fx-border-width: 0 0 4 0;">
								                    <Label text="LOANS CAN OPEN" style="-fx-font-size: 13; -fx-font-weight: bold; -fx-text-fill: #7f8c8d;"/>
								                    <Label fx:id="lblPossible50k" text="0" style="-fx-font-size: 32; -fx-font-weight: 900; -fx-text-fill: #2c3e50;"/>
								                </VBox>
								                
								                <VBox alignment="CENTER" spacing="8" HBox.hgrow="ALWAYS" style="-fx-background-color: #f1fbf4; -fx-padding: 15; -fx-background-radius: 10; -fx-border-color: #27ae60; -fx-border-width: 0 0 4 0;">
								                    <Label text="SELECTED" style="-fx-font-size: 13; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
								                    <Label fx:id="lblSelectedCount" text="0" style="-fx-font-size: 32; -fx-font-weight: 900; -fx-text-fill: #27ae60;"/>
								                </VBox>
								
								                <VBox alignment="CENTER" spacing="8" HBox.hgrow="ALWAYS" style="-fx-background-color: #f0f7fd; -fx-padding: 15; -fx-background-radius: 10; -fx-border-color: #2980b9; -fx-border-width: 0 0 4 0;">
								                    <Label text="WAITING" style="-fx-font-size: 13; -fx-font-weight: bold; -fx-text-fill: #2980b9;"/>
								                    <Label fx:id="lblWaitingCount" text="0" style="-fx-font-size: 32; -fx-font-weight: 900; -fx-text-fill: #2980b9;"/>
								                </VBox>
								
								                
								            </children>
								        </HBox>
								    </children>
								</VBox>
                            </children>
                        </VBox>

                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-border-color: #3498db; -fx-border-width: 2;" HBox.hgrow="ALWAYS">
                            <children>
                                <Label text="ðŸŽ¯ SELECTED MEMBERS" style="-fx-font-weight: bold; -fx-text-fill: #2980b9; -fx-font-size: 16;" />
                                <TableView fx:id="tblDrawResults" VBox.vgrow="ALWAYS">
                                    <columns>	                                    
                                    	<TableColumn fx:id="colDrawRank" text="Rank" minWidth="150" />
                                        <TableColumn fx:id="colDrawMemNo" text="M.No" maxWidth="100" minWidth="80" />
                                        <TableColumn fx:id="colDrawName" text="Member Name" minWidth="250" />
                                        <TableColumn fx:id="colLastLoanDate" text="Total Free (Months)" minWidth="150" />
                                        <TableColumn fx:id="colDrawStatus" text="Status" minWidth="150" />
                                    </columns>
                                    <columnResizePolicy>
                                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                    </columnResizePolicy>
                                </TableView>
                                <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 10 0 0 0;">
								    <children>
								        <Button fx:id="btnPrintList" onAction="#handleExportPDF" text="ðŸ–¨ï¸ PRINT SELECTION LIST" 
								                style="-fx-background-color: #34495e; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12 20; -fx-font-size: 14;" />
								        
								        <Region HBox.hgrow="ALWAYS" />
								
								        <Button fx:id="btnResetDraw" onAction="#handleResetDraw" text="ðŸ”„ RESET / DISCARD" 
								                style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12 20; -fx-font-size: 14;" />
								        
								        <Button fx:id="btnConfirmSave" onAction="#confirmAndSaveDraw" text="âœ… CONFIRM &amp; SAVE RESULTS" 
								                style="-fx-background-color: #8e44ad; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12 25; -fx-font-size: 14;" />
								    </children>
								</HBox>
                            </children>
                        </VBox>
                    </children>
                </HBox>
            </children>
        </VBox>

        <VBox fx:id="drawAnimationOverlay" alignment="CENTER" spacing="30" visible="false" managed="false"
		      style="-fx-background-color: rgba(44, 62, 80, 0.98);">
		    <children>
		        <ProgressIndicator prefHeight="120" prefWidth="120" style="-fx-progress-color: #f1c40f;" />
		        <VBox alignment="CENTER" spacing="10">
		            <Label fx:id="lblStatus" text="SHUFFLING APPLICANTS..." style="-fx-text-fill: white; -fx-font-size: 26; -fx-font-weight: bold;" />
		            <Label fx:id="lblCountdown" text="30 Seconds Remaining" style="-fx-text-fill: #bdc3c7; -fx-font-size: 20;" />
		        </VBox>
		        
		        <Button text="ðŸ›‘ STOP &amp; CANCEL DRAW" onAction="#handleCancelDraw" 
		                style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 25; -fx-background-radius: 5; -fx-cursor: hand;" />
		        
		        <Label text="Note: Cancelling will reset the current progress." style="-fx-text-fill: #7f8c8d; -fx-font-style: italic;" />
		    </children>
		</VBox>
    </children>
</StackPane>